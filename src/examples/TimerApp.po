import std;

namespace TimerApp {    
    static void main() {
        println("Timer App", (u32)10);
        print("Enter timer (mins):", (u32)20);
        
        u8[4] line;
        u32 count = readLine((u8*)line, (u32)4);
        if (count == (u32)0) {
            println("Invalid data.", (u32)14);
            return;
        }
        
        //println((u8*)line, count);
        
        i64 mins;
        if (parseInt((u8*)line, count, &mins) == false) {
            println("Error parsing data", (u32)19);
            return;
        }
        
        clock clock;
        clock.setNow();
        clock.addMinutes((u16)mins);

        clock_time time;
        clock.getTime(&time);
        print("Timer set for: ", (u32)16);
        println((u8*)time.text, (u32)9);

        i64 numSleeps = mins * 60;
        i64 numMinsLeft = mins;
        while (numSleeps > 0) {
            Sleep((u32)1000);
            numSleeps -= 1;
            i64 minsLeft = numSleeps / 60;
            if (minsLeft != numMinsLeft) {
                numMinsLeft = minsLeft;
                print("Time left: ", (u32)12);
                print_64(numMinsLeft + 1);
                println("(mins)", (u32)7);
            }
        }
        
        println("Timer done!", (u32)12);
    }
}
